---
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physical Science Module 9 Quiz</title>
    <!-- Load EmailJS before initializing -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" is:inline></script>
    <script type="text/javascript" is:inline>
        // Wait for EmailJS to load before initializing
        window.onload = function() {
            emailjs.init("la6DVzxI7W2gVEkX6");
        }
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .question {
            margin-bottom: 20px;
        }
        #question-number {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        #question-text {
            font-size: 16px;
            margin-bottom: 20px;
        }
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 12px 15px;
            text-align: left;
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        .option-button:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }
        .option-button.selected {
            background: #e9ecef;
            border: 1px solid #212529;
            font-weight: 500;
        }
        .option-button.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .feedback {
            margin: 15px 0;
            padding: 12px 15px;
            border-radius: 4px;
            font-size: 15px;
            display: none;
        }
        .feedback.correct {
            display: block;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .feedback.incorrect {
            display: block;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .controls button {
            padding: 8px 20px;
            font-size: 16px;
            background: #f8f9fa;
            border: 1px solid #ced4da;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        #email-section {
            margin-bottom: 20px;
        }
        #email-section input[type="email"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 250px;
        }
        #start-quiz {
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .email-status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .email-status.success {
            background-color: #c8e6c9;
            border: 1px solid #4caf50;
        }
        .email-status.error {
            background-color: #ffcdd2;
            border: 1px solid #f44336;
        }
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #f0f0f0;
            margin: 10px 0;
            border-radius: 2px;
            overflow: hidden;
        }
        .progress-bar .fill {
            height: 100%;
            background: #2196f3;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div id="email-section">
            <h2>Physical Science Module 9 Quiz</h2>
            <p>Enter your email address to start the quiz. This is optional, but required if you want to save and send your results.</p>
            <div class="email-input">
                <input type="email" id="email" placeholder="Enter your email address (optional)">
                <div class="checkbox-group">
                    <input type="checkbox" id="save-results" checked>
                    <label for="save-results">Save results and send to instructor</label>
                </div>
                <button onclick="startQuiz()">Start Quiz</button>
            </div>
        </div>

        <div id="quiz-container" style="display: none;">
            <div class="progress-bar">
                <div class="fill" style="width: 0%"></div>
            </div>
            <div id="question-number"></div>
            <div id="question-text"></div>
            <div class="options"></div>
            <div id="feedback" class="feedback"></div>
            <div class="controls">
                <button id="prevBtn" onclick="previousQuestion()" style="display: none;">Previous</button>
                <button id="nextBtn" onclick="nextQuestion()" style="display: none;">Next</button>
                <button id="submitBtn" onclick="submitQuiz()" style="display: none;">Submit Quiz</button>
            </div>
            <div id="email-status" class="email-status"></div>
        </div>
    </div>

    <script is:inline>
        // Initialize quiz state
        window.currentQuestion = 0;
        window.userAnswers = new Array(window.questions?.length || 0).fill(null);
        window.userEmail = '';
        window.questionAttempts = new Array(window.questions?.length || 0).fill(0); // Track attempts per question

        // Quiz state and questions
        window.questions = [
            {
                question: "What is a mechanical wave? (Page 347)",
                options: [
                    "A wave that only exists in machines",
                    "A disturbance in matter that transfers energy through the matter",
                    "A wave that doesn't need a medium to travel",
                    "A wave that only travels through air"
                ],
                correctAnswer: 1,
                explanation: "A mechanical wave, as defined in the study guide, is a disturbance in matter that transfers energy through that matter. Sound waves are an example of mechanical waves."
            },
            {
                question: "What are the three main types of mechanical waves?",
                options: [
                    "Light waves, sound waves, and radio waves",
                    "Water waves, sound waves, and light waves",
                    "Transverse waves, longitudinal waves, and surface waves",
                    "Primary waves, secondary waves, and surface waves"
                ],
                correctAnswer: 2,
                explanation: "Scientists classify mechanical waves into three main types: transverse waves, longitudinal waves, and surface waves."
            },
            {
                question: "In a transverse wave, how does the medium vibrate in relation to the wave's direction?",
                options: [
                    "In the same direction as the wave travels",
                    "At right angles to the direction the wave travels",
                    "In a circular motion",
                    "In random directions"
                ],
                correctAnswer: 1,
                explanation: "In transverse waves, the medium vibrates at right angles (perpendicular) to the direction in which the wave travels."
            },
            {
                question: "What is wavelength in a transverse wave?",
                options: [
                    "The height of the wave",
                    "The time between waves",
                    "The distance between two consecutive crests or troughs",
                    "The speed of the wave"
                ],
                correctAnswer: 2,
                explanation: "Wavelength is the distance between two consecutive crests or troughs in a transverse wave."
            },
            {
                question: "In a longitudinal wave, what are the compressed sections called?",
                options: [
                    "Crests",
                    "Troughs",
                    "Compressions",
                    "Wavelengths"
                ],
                correctAnswer: 2,
                explanation: "In longitudinal waves, the compressed sections where particles are closest together are called compressions."
            },
            {
                question: "What is the relationship between wave speed, wavelength, and frequency?",
                options: [
                    "Speed equals wavelength divided by frequency",
                    "Speed equals wavelength times frequency",
                    "Speed equals frequency divided by wavelength",
                    "Speed equals wavelength plus frequency"
                ],
                correctAnswer: 1,
                explanation: "As shown in Equation 9.1, wave speed (v) equals wavelength (λ) times frequency (f): v = λ × f"
            },
            {
                question: "What happens to ocean waves as they approach the shore?",
                options: [
                    "They speed up and get taller",
                    "They slow down at the bottom and topple over",
                    "They disappear completely",
                    "They maintain constant speed and height"
                ],
                correctAnswer: 1,
                explanation: "As waves enter shallow water, friction slows the bottom of the wave while the top continues at original speed, causing the wave to topple over."
            },
            {
                question: "What type of wave motion does a floating bottle in ocean waves demonstrate?",
                options: [
                    "Only up and down motion",
                    "Only back and forth motion",
                    "A combination of up-and-down and back-and-forth motion",
                    "No motion at all"
                ],
                correctAnswer: 2,
                explanation: "A floating bottle in ocean waves shows both up-and-down motion (like a transverse wave) and back-and-forth motion (like a longitudinal wave)."
            },
            {
                question: "In Experiment 9.1, what demonstrates that sound waves can travel through air?",
                options: [
                    "The rice grains bouncing on the plastic-covered bowl",
                    "The color of the candle flame",
                    "The temperature of the air",
                    "The size of the bowl"
                ],
                correctAnswer: 0,
                explanation: "The bouncing rice grains demonstrate that sound waves can travel through air and cause physical movement in objects they encounter."
            },
            {
                question: "Which material is NOT needed for the sound wave visualization experiment?",
                options: [
                    "Plastic wrap",
                    "Rice grains",
                    "String",
                    "Large bowl"
                ],
                correctAnswer: 2,
                explanation: "String is not listed in the materials needed for this experiment. The key materials are plastic wrap, rice, bowl, and items to create sound."
            },
            {
                question: "What safety equipment is required for the experiment?",
                options: [
                    "Gloves",
                    "Lab coat",
                    "Eye protection",
                    "Ear plugs"
                ],
                correctAnswer: 2,
                explanation: "Eye protection (goggles or safety glasses) is specifically listed as required safety equipment for this experiment."
            },
            {
                question: "How much more energy does a 20 dB sound have compared to a 0 dB sound?",
                options: [
                    "20 times more",
                    "100 times more",
                    "200 times more",
                    "1000 times more"
                ],
                correctAnswer: 1,
                explanation: "A 20 dB sound has 100 times (10 × 10) more energy per second than a 0 dB sound, as explained in the decibel scale."
            },
            {
                question: "What happens to sound waves in an auditorium compared to an open space?",
                options: [
                    "They always get quieter with distance",
                    "They maintain constant volume",
                    "They can increase in volume due to reflections",
                    "They disappear completely"
                ],
                correctAnswer: 2,
                explanation: "In closed spaces like auditoriums, reflections off walls or in corners can actually increase the volume, unlike in open spaces where sound simply decreases with distance."
            },
            {
                question: "What is the relationship between wavelength and frequency in sound waves?",
                options: [
                    "They are directly proportional",
                    "They are inversely proportional",
                    "They are independent of each other",
                    "They are always equal"
                ],
                correctAnswer: 1,
                explanation: "Wavelength and frequency are inversely proportional to each other. When wavelength is large, frequency is small, and vice-versa."
            },
            {
                question: "What is the Doppler effect?",
                options: [
                    "The change in sound volume as distance increases",
                    "The change in frequency caused by motion of the source, listener, or both",
                    "The reflection of sound waves off surfaces",
                    "The absorption of sound waves by materials"
                ],
                correctAnswer: 1,
                explanation: "The Doppler effect is a change in sound frequency caused by the motion of the sound source, motion of the listener, or both."
            },
            {
                question: "What range of frequencies can human ears typically detect?",
                options: [
                    "0 Hz to 10,000 Hz",
                    "20 Hz to 20,000 Hz",
                    "100 Hz to 50,000 Hz",
                    "1,000 Hz to 100,000 Hz"
                ],
                correctAnswer: 1,
                explanation: "In general, human ears are sensitive to waves with frequencies between 20 Hz and 20,000 Hz. These are called sonic waves."
            },
            {
                question: "Which animal can hear ultrasonic waves?",
                options: [
                    "Elephants",
                    "Whales",
                    "Bats",
                    "Humans"
                ],
                correctAnswer: 2,
                explanation: "Bats can hear sounds with frequencies up to 100,000 Hz, which are in the ultrasonic range (above 20,000 Hz)."
            },
            {
                question: "What is the primary difference between a submarine's sonar and a bat's sonar system? (Page 342)",
                options: [
                    "Submarines use lower frequencies",
                    "Bats can only detect small objects",
                    "Bat sonar provides more detailed information and is more efficient",
                    "Submarine sonar works underwater only"
                ],
                correctAnswer: 2,
                explanation: "According to the text, a bat's sonar system is remarkably efficient - it weighs less than 1 gram yet provides more detailed information than any human-made sonar. It can process information faster than our best computers and detect up to 5 insects per second!"
            },
            {
                question: "When a guitar player shortens a string by pressing it against the fretboard, what happens to the pitch? (Page 348, Question 14)",
                options: [
                    "The pitch increases",
                    "The pitch decreases",
                    "The pitch stays the same",
                    "The pitch becomes random"
                ],
                correctAnswer: 0,
                explanation: "When you shorten a guitar string's length, its frequency increases, resulting in a higher pitch. This is why pressing strings against frets closer to the bridge produces higher notes."
            },
            {
                question: "If two musical notes have the same pitch but different loudness, which wave properties are the same? (Page 348, Question 15)",
                options: [
                    "Only wavelength is the same",
                    "Wavelength, frequency, and speed are the same",
                    "Only amplitude is the same",
                    "Only speed is the same"
                ],
                correctAnswer: 1,
                explanation: "When two notes have the same pitch but different loudness, their wavelength, frequency, and speed remain the same. Only the amplitude differs, which affects the loudness but not the pitch."
            },
            {
                question: "What is supersonic speed? (Page 347)",
                options: [
                    "The speed of light",
                    "Any speed faster than sound in the medium",
                    "The speed of a jet engine",
                    "The speed that breaks glass"
                ],
                correctAnswer: 1,
                explanation: "As defined in the study guide, supersonic speed is any speed that is faster than the speed of sound in the medium of interest."
            },
            {
                question: "A jet aircraft is traveling at Mach 2.5 through air at 1°C. What is the jet's speed in m/s? (Page 348, Question 11)",
                options: [
                    "About 331 m/s",
                    "About 464 m/s",
                    "About 828 m/s",
                    "About 1160 m/s"
                ],
                correctAnswer: 2,
                explanation: "At 1°C, the speed of sound is approximately 331 m/s. Mach 2.5 means the jet is traveling at 2.5 times the speed of sound, so 331 × 2.5 = 828 m/s."
            },
            {
                question: "Why do jets travel at speeds of Mach 1 or higher only in sparsely populated regions? (Page 348, Question 13)",
                options: [
                    "To avoid air traffic",
                    "To prevent sonic booms from disturbing populated areas",
                    "Because they need more space to fly",
                    "Because the air is thinner at high altitudes"
                ],
                correctAnswer: 1,
                explanation: "Jets avoid flying at supersonic speeds over populated areas because sonic booms can be disruptive and potentially damaging to structures and people below."
            },
            {
                question: "A sound wave is traveling through air at 30°C. What is its speed? (Page 348, Question 3)",
                options: [
                    "331 m/s",
                    "349 m/s",
                    "300 m/s",
                    "400 m/s"
                ],
                correctAnswer: 1,
                explanation: "The speed of sound increases with temperature. At 30°C, sound travels at approximately 349 meters per second through air, faster than at 0°C (331 m/s)."
            },
            {
                question: "If a sound wave has a wavelength of 0.5 meters and is traveling through air at 30°C (speed = 349 m/s), what is its frequency? (Page 348, Question 4)",
                options: [
                    "174.5 Hz",
                    "698 Hz",
                    "524 Hz",
                    "872 Hz"
                ],
                correctAnswer: 1,
                explanation: "To find frequency, divide wave speed by wavelength: 349 m/s ÷ 0.5 m = 698 Hz. This uses the wave equation: speed = wavelength × frequency."
            },
            {
                question: "A sound wave has a speed of 345 m/s and a wavelength of 500 meters. Is this wave infrasonic, sonic, or ultrasonic? (Page 348, Question 5)",
                options: [
                    "Infrasonic (below human hearing range)",
                    "Sonic (within human hearing range)",
                    "Ultrasonic (above human hearing range)",
                    "Cannot be determined without more information"
                ],
                correctAnswer: 0,
                explanation: "Using speed = wavelength × frequency: 345 = 500 × f, so f = 0.69 Hz. Since this is below 20 Hz (the lower limit of human hearing), this is an infrasonic wave."
            },
            {
                question: "In medical ultrasound imaging, what happens when ultrasonic waves hit an obstruction in the body? (Page 341)",
                options: [
                    "They completely stop",
                    "Part is reflected and part is transmitted, both with lower amplitude",
                    "They change frequency",
                    "They increase in amplitude"
                ],
                correctAnswer: 1,
                explanation: "When ultrasonic waves hit an obstruction, part of the wave is reflected and part is transmitted, both with lower amplitudes than the original wave."
            }
        ];

        // Quiz functions
        function startQuiz() {
            // Get all required elements first
            const emailSection = document.getElementById('email-section');
            const quizContainer = document.getElementById('quiz-container');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Validate elements exist
            if (!emailSection || !quizContainer || !prevBtn || !nextBtn) {
                console.error('Required quiz elements not found');
                return;
            }

            // Hide email section and show quiz
            emailSection.style.display = 'none';
            quizContainer.style.display = 'block';
            
            // Set initial button states
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'block';
            
            // Initialize quiz state
            window.currentQuestion = 0;
            window.userAnswers = new Array(window.questions?.length || 0).fill(null);
            window.userEmail = document.getElementById('email')?.value || '';
            window.questionAttempts = new Array(window.questions?.length || 0).fill(0); // Track attempts per question

            // Show first question
            showQuestion(0);
        }

        function showQuestion(index) {
            const question = window.questions[index];
            if (!question) return;

            // Update progress bar
            const progressBar = document.querySelector('.progress-bar .fill');
            if (progressBar) {
                const progress = ((index + 1) / window.questions.length) * 100;
                progressBar.style.width = `${progress}%`;
            }

            const questionNumber = document.getElementById('question-number');
            questionNumber.textContent = `Question ${index + 1} of ${window.questions.length}`;

            const questionText = document.getElementById('question-text');
            questionText.textContent = `${question.question}`;

            const optionsDiv = document.querySelector('.options');
            optionsDiv.innerHTML = '';
            
            question.options.forEach((option, i) => {
                const button = document.createElement('button');
                button.className = `option-button ${window.userAnswers[index] === i ? 'selected' : ''}`;
                button.textContent = option;
                button.onclick = () => selectAnswer(i);
                
                // Disable button if question is already answered correctly or max attempts reached
                if (window.userAnswers[index] === question.correctAnswer || window.questionAttempts[index] >= 2) {
                    button.disabled = true;
                    if (i === question.correctAnswer) {
                        button.classList.add('correct');
                    }
                }
                
                optionsDiv.appendChild(button);
            });

            // Reset feedback
            const feedback = document.getElementById('feedback');
            if (feedback) {
                feedback.className = 'feedback';
                feedback.textContent = '';
            }

            // Show feedback if question was already answered
            if (window.userAnswers[index] !== null) {
                const options = document.querySelectorAll('.option-button');
                if (options && options.length > 0) {
                    selectAnswer(window.userAnswers[index]);
                }
            }

            updateNavigation();
        }

        function selectAnswer(optionIndex) {
            const currentAttempts = window.questionAttempts[window.currentQuestion];
            const question = window.questions[window.currentQuestion];
            const options = document.querySelectorAll('.option-button');
            const feedback = document.getElementById('feedback');
            
            // If already answered correctly or max attempts reached, do nothing
            if (window.userAnswers[window.currentQuestion] === question.correctAnswer || currentAttempts >= 2) {
                return;
            }
            
            // Increment attempts for this question
            window.questionAttempts[window.currentQuestion]++;
            
            // Update user's answer
            window.userAnswers[window.currentQuestion] = optionIndex;
            
            // Remove selected class from all options
            options.forEach(option => option.classList.remove('selected'));
            
            // Add selected class to clicked option
            if (options[optionIndex]) {
                options[optionIndex].classList.add('selected');
            }

            // Show feedback
            if (feedback && question) {
                if (optionIndex === question.correctAnswer) {
                    feedback.className = 'feedback correct';
                    feedback.textContent = `Correct! ${question.explanation || ''}`;
                    
                    // Disable all options after correct answer
                    options.forEach(option => option.disabled = true);
                } else {
                    feedback.className = 'feedback incorrect';
                    
                    // If max attempts reached
                    if (window.questionAttempts[window.currentQuestion] >= 2) {
                        feedback.textContent = `Incorrect. You've used all your attempts. The correct answer is "${question.options[question.correctAnswer]}". ${question.explanation || ''}`;
                        
                        // Disable all options and highlight correct answer
                        options.forEach((option, index) => {
                            option.disabled = true;
                            if (index === question.correctAnswer) {
                                option.classList.add('correct');
                            }
                        });
                    } else {
                        feedback.textContent = `Incorrect. You have ${2 - window.questionAttempts[window.currentQuestion]} attempt${window.questionAttempts[window.currentQuestion] === 1 ? '' : 's'} remaining.`;
                    }
                }
            }
            
            updateNavigation();
        }

        function previousQuestion() {
            if (window.currentQuestion > 0) {
                window.currentQuestion--;
                showQuestion(window.currentQuestion);
            }
        }

        function nextQuestion() {
            if (window.currentQuestion < window.questions.length - 1) {
                window.currentQuestion++;
                showQuestion(window.currentQuestion);
            }
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            // Show/hide Previous button
            prevBtn.style.display = window.currentQuestion > 0 ? 'inline-block' : 'none';

            // Show/hide Next button
            nextBtn.style.display = window.currentQuestion < window.questions.length - 1 ? 'inline-block' : 'none';

            // Show/hide Submit button
            const allAnswered = window.userAnswers.slice(0, window.currentQuestion + 1).every(answer => answer !== null);
            submitBtn.style.display = window.currentQuestion === window.questions.length - 1 && allAnswered ? 'inline-block' : 'none';
        }

        function submitQuiz() {
            const score = window.userAnswers.reduce((total, answer, index) => {
                return total + (answer === window.questions[index].correctAnswer ? 1 : 0);
            }, 0);

            // Show final results
            showFinalResults();

            // Only send email if user opted in
            const saveResults = document.getElementById('save-results');
            const email = document.getElementById('email').value;
            
            if (saveResults && saveResults.checked && email) {
                // Build email message with detailed results
                let emailMessage = `Score: ${score} out of ${window.questions.length} (${((score / window.questions.length) * 100).toFixed(1)}%)\n\n`;
                
                // Add incorrect answers section
                const incorrectAnswers = window.userAnswers.map((answer, index) => {
                    const q = window.questions[index];
                    if (answer !== q.correctAnswer) {
                        return {
                            question: q.question,
                            yourAnswer: q.options[answer],
                            correctAnswer: q.options[q.correctAnswer],
                            reference: q.reference || 'See textbook'
                        };
                    }
                    return null;
                }).filter(item => item !== null);

                if (incorrectAnswers.length > 0) {
                    emailMessage += 'Incorrect Answers:\n\n';
                    incorrectAnswers.forEach(item => {
                        emailMessage += `Question: ${item.question}\n`;
                        emailMessage += `Your Answer: ${item.yourAnswer}\n`;
                        emailMessage += `Correct Answer: ${item.correctAnswer}\n`;
                        emailMessage += `Reference: ${item.reference}\n\n`;
                    });
                } else {
                    emailMessage += 'Perfect Score! All answers correct!\n';
                }

                // Check if emailjs is loaded and initialized
                if (typeof emailjs !== 'undefined') {
                    emailjs.send(
                        "service_ot1jg6s", // Service ID from module 8
                        "template_v678xjf", // Template ID from module 8
                        {
                            from_name: 'Physical Science Quiz System',
                            student_email: email,
                            to_name: 'Instructor',
                            subject: 'Physical Science Module 9 Quiz Results',
                            message: `Student Email: ${email}\n\n${emailMessage}`,
                            reply_to: email
                        }
                    ).then(
                        function(response) {
                            console.log("Email sent successfully", response);
                            const emailStatus = document.getElementById('email-status');
                            if (emailStatus) {
                                emailStatus.textContent = 'Results sent successfully!';
                                emailStatus.className = 'email-status success';
                                emailStatus.style.display = 'block';
                            }
                        },
                        function(error) {
                            console.error("Failed to send email:", error);
                            const emailStatus = document.getElementById('email-status');
                            if (emailStatus) {
                                emailStatus.textContent = 'Error sending results. Please try again or contact your instructor.';
                                emailStatus.className = 'email-status error';
                                emailStatus.style.display = 'block';
                            }
                        }
                    );
                } else {
                    console.error("EmailJS not loaded");
                    const emailStatus = document.getElementById('email-status');
                    if (emailStatus) {
                        emailStatus.textContent = 'Email service not available. Please try again later or contact support.';
                        emailStatus.className = 'email-status error';
                        emailStatus.style.display = 'block';
                    }
                }
            }
        }
        window.submitQuiz = submitQuiz;

        function showFinalResults() {
            const score = window.userAnswers.reduce((total, answer, index) => {
                return total + (answer === window.questions[index].correctAnswer ? 1 : 0);
            }, 0);

            const feedback = document.getElementById('feedback');
            if (feedback) {
                const percentage = (score / window.questions.length) * 100;
                feedback.className = 'feedback correct';
                feedback.textContent = `Quiz completed! Your score: ${score}/${window.questions.length} (${percentage.toFixed(1)}%)`;
            }

            // Hide navigation buttons after submission
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'none';
        }

        // Initialize quiz when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize quiz state
                window.currentQuestion = 0;
                window.userAnswers = new Array(window.questions?.length || 0).fill(null);
                window.userEmail = '';
                window.questionAttempts = new Array(window.questions?.length || 0).fill(0); // Track attempts per question

                // Hide quiz container initially
                const quizContainer = document.getElementById('quiz-container');
                if (quizContainer) {
                    quizContainer.style.display = 'none';
                }
            });
        } else {
            // Initialize quiz state
            window.currentQuestion = 0;
            window.userAnswers = new Array(window.questions?.length || 0).fill(null);
            window.userEmail = '';
            window.questionAttempts = new Array(window.questions?.length || 0).fill(0); // Track attempts per question

            // Hide quiz container initially
            const quizContainer = document.getElementById('quiz-container');
            if (quizContainer) {
                quizContainer.style.display = 'none';
            }
        }
    </script>
</body>
</html>

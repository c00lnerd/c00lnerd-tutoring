---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Experiment 2.3: Changes in Matter">
    <div class="container">
        <h1>Experiment 2.3: Changes in Matter</h1>
        
        <div class="email-section">
            <h3>Student Information</h3>
            <p>Enter your email so your instructor can see your experiment results:</p>
            <input type="email" id="studentEmail" placeholder="your.email@example.com" />
        </div>

        <div class="experiment-content">
            <h2>Purpose</h2>
            <p>To explore physical and chemical changes in matter.</p>

            <h2>Materials</h2>
            <div class="materials-grid">
                <div class="material-item"> Beaker or small clear glass</div>
                <div class="material-item"> Baking soda</div>
                <div class="material-item"> Tap water</div>
                <div class="material-item"> 9 volt battery</div>
                <div class="material-item"> Two 9 inch pieces of insulated wire (copper)</div>
                <div class="material-item"> Scissors</div>
                <div class="material-item"> Some tape</div>
                <div class="material-item"> Spoon for stirring</div>
                <div class="material-item"> Eye protection (goggles/safety glasses)</div>
            </div>

            <h2>Question</h2>
            <div class="question-section">
                <p><strong>What types of clues indicate physical and chemical changes are occurring?</strong></p>
            </div>

            <h2>Hypothesis</h2>
            <div class="hypothesis-section">
                <p>Write what you predict will happen when you add electricity through a copper wire to a solution of baking soda and water:</p>
                <textarea id="hypothesis" placeholder="Enter your prediction..."></textarea>
            </div>

            <h2>Procedure</h2>
            <div class="procedure-section">
                <div class="step">
                    <h4>Step 1: Prepare Solution</h4>
                    <p>Fill the beaker or small glass ¾ full of tap water.</p>
                </div>

                <div class="step">
                    <h4>Step 2: Add Baking Soda</h4>
                    <p>Add a teaspoon of baking soda and stir vigorously.</p>
                    <textarea id="step2_observations" placeholder="Record observations after adding baking soda..."></textarea>
                </div>

                <div class="step">
                    <h4>Step 3: Prepare Wires</h4>
                    <p>Use your scissors to strip about ¼ inch of insulation off both ends of each wire. Squeeze the scissors gently as you slowly turn the wire round and round.</p>
                    <div class="safety-warning">
                        <p><strong> Be careful!</strong> You can cut yourself if you are not paying proper attention! You will eventually have a cut that goes through the insulation all the way around the wire. At that point, you can simply pull the insulation off.</p>
                    </div>
                </div>

                <div class="step">
                    <h4>Step 4: Connect to Battery</h4>
                    <p>Once you have stripped the insulation off both ends of each wire, connect the end of one wire to one of the two terminals on the battery. Do this by laying the wire over the terminal and then pressing it down. Secure it to the terminal with a piece of tape. It need not look pretty, but the bare wire needs to be solidly touching one terminal and not in contact with the other terminal.</p>
                </div>

                <div class="step">
                    <h4>Step 5: Connect Second Wire</h4>
                    <p>Repeat step 4 with the other wire and the other battery terminal. Now you have two wires attached to the battery, one at each terminal. <strong>Do not allow the bare ends of these wires to touch each other!</strong></p>
                </div>

                <div class="step">
                    <h4>Step 6: Immerse Wires</h4>
                    <p>Immerse the wires in the baking soda/water solution that is in the small glass so that the bare end of each wire is completely submerged. It doesn't really matter how much of the insulated portion of the wire is immersed, just make sure that the entire bare end of each wire is fully submerged. Once again, don't allow the ends to touch each other. In the end, your experiment should look something like this:</p>
                    
                    <div class="diagram-section">
                        <div class="circuit-diagram">
                            <p><em>Circuit diagram showing battery connected to wires immersed in baking soda solution</em></p>
                        </div>
                    </div>
                </div>

                <div class="step">
                    <h4>Step 7: Observe</h4>
                    <p>Look at the bare ends of the wires as they are submerged in the baking soda/water solution. What do you see? Well, if you set everything up right, you should see bubbles coming from both ends. If you don't see bubbles, most likely you do not have good contact between the wires and the battery terminals. Try pressing the ends of the wire hard against the terminals to which they are taped. If you then see bubbles coming from the submerged ends of the wire, then you know that electrical contact is your problem. If not, then your battery might be dead. Try another one.</p>
                    <textarea id="step7_observations" placeholder="Record what you observe at the wire ends..."></textarea>
                </div>

                <div class="step">
                    <h4>Step 8: Extended Observation</h4>
                    <p>Once you get things working, spend some time observing what's going on. Notice that bubbles are forming on both wires.</p>
                    <textarea id="step8_observations" placeholder="Record detailed observations of bubble formation..."></textarea>
                </div>

                <div class="step">
                    <h4>Step 9: Check Wire Changes</h4>
                    <p>Allow the experiment to run for about 10 minutes. After that time, pull the wires out of the solution and look at the bare ends. What do you see? Well, one of the wires should not look very different from when you started. It might be darker than it was, but that should be it. What about the end of the other wire? It should now be a different color. What color is it? Write that color down.</p>
                    <textarea id="step9_observations" placeholder="Describe the color change in the wire..."></textarea>
                </div>

                <div class="step">
                    <h4>Step 10: Solution Color Check</h4>
                    <p>If you let the experiment run for 10 minutes, it's very possible that your solution became slightly colored. Write whether or not that happened and what color, if any, the solution became.</p>
                    <textarea id="step10_observations" placeholder="Record any color changes in the solution..."></textarea>
                </div>

                <div class="step">
                    <h4>Step 11: Identify Terminal</h4>
                    <p>Looking at the wire that changed color, trace it back to the battery and determine the terminal (positive or negative) to which it is attached.</p>
                    <textarea id="step11_observations" placeholder="Record which terminal the changed wire was connected to..."></textarea>
                </div>

                <div class="step">
                    <h4>Step 12: Clean Up</h4>
                    <p>Disconnect the wires from the battery, dump the solution down the sink, run tap water to flush it down the drain, and wash the glass thoroughly. Put everything away.</p>
                </div>
            </div>

            <h2>Conclusions</h2>
            <div class="conclusions-section">
                <div class="question-group">
                    <label for="change_explanation">Explain your observations in terms of the clues for chemical and physical changes you learned about. Can you say a chemical reaction occurred? Explain how you know.</label>
                    <textarea id="change_explanation" placeholder="Explain whether chemical or physical changes occurred and your evidence..."></textarea>
                </div>

                <div class="question-group">
                    <label for="hypothesis_check">Was your hypothesis correct? What actually happened compared to your prediction?</label>
                    <textarea id="hypothesis_check" placeholder="Compare your results to your original hypothesis..."></textarea>
                </div>

                <div class="question-group">
                    <label for="clues_observed">What clues did you observe that indicated changes were taking place?</label>
                    <textarea id="clues_observed" placeholder="List the specific clues you observed (bubbles, color changes, etc.)..."></textarea>
                </div>
            </div>

            <div class="submit-section">
                <button id="submitResults" class="submit-btn">Submit Experiment Results</button>
                <div id="submitStatus" class="submit-status"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" is:inline></script>
    <script>
        // Initialize EmailJS with error checking
        if (typeof emailjs !== 'undefined') {
            emailjs.init("la6DVzxI7W2gVEkX6");
        }

        document.addEventListener('DOMContentLoaded', function() {
            const savedEmail = localStorage.getItem('studentEmail');
            if (savedEmail) {
                document.getElementById('studentEmail').value = savedEmail;
            }
        });

        document.getElementById('studentEmail').addEventListener('change', function() {
            localStorage.setItem('studentEmail', this.value);
        });

        document.getElementById('submitResults').addEventListener('click', function() {
            const email = document.getElementById('studentEmail').value;
            
            if (!email) {
                alert('Please enter your email address before submitting.');
                return;
            }

            if (typeof emailjs === 'undefined') {
                alert('EmailJS is not loaded. Please refresh the page and try again.');
                return;
            }

            const data = {
                hypothesis: document.getElementById('hypothesis').value,
                step2_observations: document.getElementById('step2_observations').value,
                step7_observations: document.getElementById('step7_observations').value,
                step8_observations: document.getElementById('step8_observations').value,
                step9_observations: document.getElementById('step9_observations').value,
                step10_observations: document.getElementById('step10_observations').value,
                step11_observations: document.getElementById('step11_observations').value,
                change_explanation: document.getElementById('change_explanation').value,
                hypothesis_check: document.getElementById('hypothesis_check').value,
                clues_observed: document.getElementById('clues_observed').value
            };

            const message = `
EXPERIMENT 2.3: CHANGES IN MATTER RESULTS
Student Email: ${email}
Submission Time: ${new Date().toLocaleString()}

=== HYPOTHESIS ===
${data.hypothesis}

=== PROCEDURE OBSERVATIONS ===
Step 2 (Baking Soda Added): ${data.step2_observations}
Step 7 (Wire Ends): ${data.step7_observations}
Step 8 (Bubble Formation): ${data.step8_observations}
Step 9 (Wire Color Change): ${data.step9_observations}
Step 10 (Solution Color): ${data.step10_observations}
Step 11 (Terminal Identification): ${data.step11_observations}

=== CONCLUSIONS ===
Change Explanation: ${data.change_explanation}
Hypothesis Check: ${data.hypothesis_check}
Clues Observed: ${data.clues_observed}
            `;

            const templateParams = {
                to_email: 'instructor@example.com',
                from_email: email,
                message: message,
                subject: 'Experiment 2.3 Results - Changes in Matter'
            };

            // Console logging for debugging
            console.log('=== EXPERIMENT 2.3 EMAIL DATA ===');
            console.log('Student Email:', email);
            console.log('Submission Time:', new Date().toLocaleString());
            console.log('EmailJS Template Params:', templateParams);
            console.log('Full Message Content:');
            console.log(message);
            console.log('=====================================');

            document.getElementById('submitStatus').innerHTML = 'Sending results...';
            
            emailjs.send("service_ot1jg6s", "template_v678xjf", templateParams)
                .then(function(response) {
                    console.log('✅ EmailJS Success Response:', response);
                    document.getElementById('submitStatus').innerHTML = 
                        '<span style="color: green;">✓ Results sent successfully!</span>';
                }, function(error) {
                    console.error('❌ EmailJS Error:', error);
                    document.getElementById('submitStatus').innerHTML = 
                        '<span style="color: red;">✗ Failed to send results.</span>';
                });
        });
    </script>

    <style>
        .container { max-width: 900px; margin: 0 auto; padding: 20px; font-family: 'Segoe UI', sans-serif; }
        h1 { color: #2c3e50; text-align: center; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        .email-section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #3498db; }
        #studentEmail { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 4px; font-size: 16px; margin-top: 10px; }
        .materials-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin: 20px 0; }
        .material-item { padding: 10px; background: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef; }
        .question-section, .hypothesis-section { background: #e8f4f8; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #3498db; }
        .step { background: #ffffff; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .step h4 { color: #2c3e50; margin-top: 0; border-bottom: 2px solid #3498db; padding-bottom: 8px; }
        .safety-warning { background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107; margin: 15px 0; }
        .diagram-section { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; margin: 15px 0; }
        textarea { width: 100%; min-height: 80px; padding: 10px; border: 2px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical; margin-top: 10px; }
        .question-group { margin-bottom: 25px; }
        .question-group label { display: block; font-weight: bold; margin-bottom: 10px; color: #2c3e50; }
        .submit-section { text-align: center; margin-top: 40px; padding: 30px; background: #f8f9fa; border-radius: 8px; }
        .submit-btn { background: #28a745; color: white; padding: 15px 30px; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .submit-btn:hover { background: #218838; }
        .submit-status { margin-top: 15px; font-weight: bold; }
        @media (max-width: 768px) { .container { padding: 15px; } .materials-grid { grid-template-columns: 1fr; } }
    </style>
</Layout>
